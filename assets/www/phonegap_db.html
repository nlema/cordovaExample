<!DOCTYPE HTML>
<html>
    <head>
        <title>PhoneGap - Base de datos</title>
        <meta http-equiv="Content-Type" content="text/html charset=UTF-8" />
		<meta name="format-detection" content="telephone=no" />
		<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
		<link rel="stylesheet" href="css/jquery.mobile-1.2.0.min.css" />
		<link rel="stylesheet" href="css/jquery.mobile.structure-1.2.0.min.css" />
		<link rel="stylesheet" type="text/css" href="css/index.css" />
		<script src="js/jquery-1.8.3.min.js"></script>
		<script src="js/jquery.mobile-1.2.0.min.js"></script>
		<script type="text/javascript" src="js/cordova-2.2.0.js"></script>
        <script type="text/javascript">
            var cajaNombre = null;
            var cajaApellido = null;
            var db = null;
            var dataTable = null;
            /** Called when phonegap javascript is loaded */
            function onDeviceReady(){
                var btnAgregar = document.getElementById("agregar");
                                cajaNombre = document.getElementById("nombre");
                                cajaApellido = document.getElementById("apellido");
                                dataTable = document.getElementById("data-table");
                                db = window.openDatabase("contactosDB", "1.0", "Base Contactos", 1000000);//nombre,version,Nombre a mostrar,tamanio
                btnAgregar.addEventListener(
                                        "click",
                                        function(){
                                                
                                                db.transaction(
                                                     //funcion con sentencias sql
                                                     function (tx){
                                                            meAseguroExistenciaTabla(tx);
                                                            var nombre = cajaNombre.value;
                                                            var apellido = cajaApellido.value;
                                                             
                                                            var sql = 'INSERT INTO Contactos (nombre, apellido) VALUES ("'+nombre+'","'+apellido+'")';
                                                            tx.executeSql(sql);
                                                        
                                                        },
                                                        //error callback
                                                        function (err){
                                                                alert("error callback "+err.code);
                                                                
                                                        },
                                                        //success callback
                                                        function (err){
                                                                //alert("success callback "+err.code);
                                                                cargoDesdeDB();
                                                        }
                                                        );
                                                
                                                
                        }, 
                                        false);
                                cargoDesdeDB();
                
            }
            
                        function cargoDesdeDB(){
                                
                                db.transaction(
                                                      //funcion con sentencias sql
                                                      function (tx){
                                                            meAseguroExistenciaTabla(tx);
                                                            tx.executeSql('SELECT * FROM Contactos', [],
                                                                       function(tx, results){
                                                                               var htmlStr=""; 
                                                                               for(var index=0;index<results.rows.length;index++){
                                                                                        var item = results.rows.item(index);
                                                                                        htmlStr=htmlStr+"<tr><td>"+item.nombre+"</td><td>"+item.apellido+"</td><td><button onclick=\"borroEntrada('"+item.id+"');\">X</button></td></tr>";
                                                                                                                
                                                                                        }
                                                                               dataTable.innerHTML=htmlStr;
                                                                       },
                                                                       function(err){
                                                                              alert("No puedo obtener resultados de la tabla");
                                                                                                }
                                                                                        );                                                                                              
                                                        
                                                        },
                                                        //error callback
                                                        function (err){
                                                                alert("error callback "+err.code+" "+err.message);
                                                                
                                                        },
                                                        //success callback
                                                        function (){
                                                                cajaNombre.value="";
                                                                cajaApellido.value="";
                                                                
                                                        }
                                                        ); 
                                
                                 
                        }
                        
                        function borroEntrada(id){
                                db.transaction(
                                                        //funcion con sentencia sql
                                                        function (tx){
                                                                meAseguroExistenciaTabla(tx);
                                                                tx.executeSql('Delete FROM Contacts where id='+id);                                                                                             
                                                        
                                                        },
                                                        //error callback
                                                        function (err){
                                                                alert("error callback "+err.code+" "+err.message);
                                                                
                                                        },
                                                        //success callback
                                                        function (err){
                                                                //alert("success callback ");
                                                                cargoDesdeDB();
                                                                
                                                        }
                                                        );
                                
                                 
                        }
                        
            function meAseguroExistenciaTabla(tx){
                        tx.executeSql('CREATE TABLE IF NOT EXISTS Contactos (id INTEGER PRIMARY KEY, nombre,apellido)');
                        
                        }
            /** Llamado cuando el browser carga esta pagina*/
            function init(){
                document.addEventListener("deviceready", onDeviceReady, false);
            }
        </script>
        <style>
            td {
                width: 100px;
            }
            
            input {
                width: 100px;
            }
        </style>
    </head>
    <body onLoad="init()">
        <h3>Leer y escribir la DB</h3>
        <table border="1">
            <tr>
                <td>
                    <b>Nombre</b>
                </td>
                <td>
                    <b>Apellido</b>
                </td>
                <td>
                    <b>Accion</b>
                </td>
            </tr>
        </table>
        <table id="data-table">
        </table>
        <table>
            <tr>
                <td>
                    <input id="nombre" type="text">
                    </input>
                </td>
                <td>
                    <input id="apellido" type="text">
                    </input>
                </td>
                <td>
                    <button id="agregar">
                        +
                    </button>
                </td>
            </tr>
        </table>
    </body>
</html>